<!doctype html>
<html lang="tr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Şifre Gönderme | OBS</title>

<link rel="icon" href="/images/favicon.png" type="image/png" />

<style>
:root{
  --bg1:#0b1220;
  --bg2:#0f2a3a;
  --border: rgba(255,255,255,.14);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.65);
  --accent:#22c55e;
  --accent2:#38bdf8;
  --danger:#fb7185;
  --shadow: 0 18px 60px rgba(0,0,0,.45);
  --radius: 18px;
  --ring: 0 0 0 4px rgba(56,189,248,.18);
  --font: system-ui, -apple-system, Segoe UI, Roboto, Arial;
}

*{ box-sizing:border-box; }

body{
  margin:0; min-height:100vh;
  font-family:var(--font);
  color:var(--text);
  background:
    radial-gradient(900px 500px at 20% 10%, rgba(56,189,248,.22), transparent 55%),
    radial-gradient(800px 500px at 80% 20%, rgba(34,197,94,.18), transparent 60%),
    linear-gradient(160deg, var(--bg1), var(--bg2));
  display:grid;
  place-items:center;
  padding: 24px;
}

body:before{
  content:"";
  position:fixed; inset:0;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
  opacity:.25; pointer-events:none;
  mix-blend-mode: overlay;
}

.obs-panel{
  width:100%;
  max-width: 420px;
  border:1px solid var(--border);
  background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 22px 22px 20px;
  backdrop-filter: blur(14px);
}

.obs-panelTop{
  display:flex;
  align-items:center;
  justify-content:center;
  padding-bottom: 14px;
}
.obs-panelTop img{
  max-width:180px;
  height:auto;
  filter: drop-shadow(0 12px 20px rgba(0,0,0,.25));
}

.obs-title{
  margin: 0 0 6px;
  font-size: 18px;
  text-align:center;
}
.obs-hint{
  margin: 0 0 16px;
  color: var(--muted);
  font-size: 13px;
  text-align:center;
}

.obs-field{ position:relative; margin: 12px 0; }

.obs-input{
  width:100%;
  padding: 16px 14px 14px 44px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(10,18,32,.35);
  color: var(--text);
  outline:none;
  font-size: 14px;
  transition: .15s ease;
}
.obs-input:focus{
  border-color: rgba(56,189,248,.6);
  box-shadow: var(--ring);
  background: rgba(10,18,32,.50);
}

.obs-label{
  position:absolute;
  left:44px; top:50%;
  transform: translateY(-50%);
  color: rgba(255,255,255,.55);
  font-size: 14px;
  pointer-events:none;
  transition:.15s ease;
}
.obs-input:focus + .obs-label,
.obs-input:not(:placeholder-shown) + .obs-label{
  top: 9px;
  transform:none;
  font-size: 12px;
  color: rgba(255,255,255,.70);
}

.obs-icon{
  position:absolute;
  left:14px; top:50%;
  transform: translateY(-50%);
  width:18px; height:18px;
  opacity:.75;
}

.obs-btn{
  width:100%;
  border:none;
  padding: 12px 14px;
  border-radius: 14px;
  font-weight: 800;
  letter-spacing:.2px;
  color: #05210f;
  background: linear-gradient(135deg, #22c55e, #4ade80);
  cursor:pointer;
  transition: .15s ease;
}
.obs-btn:hover{ transform: translateY(-1px); filter: brightness(1.02); }

.obs-msg{
  margin-top: 10px;
  padding: 10px 12px;
  border-radius: 12px;
  font-size: 13px;
}
.obs-error{
  border: 1px solid rgba(251,113,133,.35);
  background: rgba(251,113,133,.10);
  color: #fff;
}
.obs-success{
  border: 1px solid rgba(34,197,94,.35);
  background: rgba(34,197,94,.10);
  color: #fff;
}

.obs-row{
  margin-top: 14px;
  text-align:center;
  font-size: 13px;
  color: var(--muted);
}
.obs-row a{
  color: rgba(56,189,248,.92);
  text-decoration:none;
  font-weight:800;
}
.obs-row a:hover{ text-decoration: underline; }
</style>
</head>

<body>

<section class="obs-panel">

  <div class="obs-panelTop">
    <img th:src="@{/images/logo/obs_logo_new.svg}" alt="OBS Logo">
  </div>

  <h3 class="obs-title">Şifre Gönderme</h3>
  <p class="obs-hint">E-posta adresini gir, yeni şifre gönderelim.</p>

  <div class="obs-field">
    <svg class="obs-icon" viewBox="0 0 24 24" fill="none">
      <path d="M4 7l8 6 8-6" stroke="rgba(255,255,255,.75)" stroke-width="1.6" stroke-linecap="round"/>
      <path d="M4.5 6.5h15v11h-15z" stroke="rgba(255,255,255,.35)" stroke-width="1.2"/>
    </svg>
    <input class="obs-input" type="email" id="email" placeholder=" " required />
    <label class="obs-label">E-mail</label>
  </div>

  <div id="error" class="obs-msg obs-error" style="display:none;"></div>
  <div id="message" class="obs-msg obs-success" style="display:none;"></div>

  <button type="button" class="obs-btn" onclick="sendPassword()">Gönder</button>

  <div class="obs-row">
    Zaten hesabın var mı? <a href="/login">Login</a>
  </div>

</section>

<script>
async function sendPassword() {
  const emailInput = document.getElementById("email");
  const errorLabel = document.getElementById("error");
  const messageSpan = document.getElementById("message");

  errorLabel.style.display = "none";
  messageSpan.style.display = "none";
  document.body.style.cursor = "wait";

  try {
    const response = await fetch("/user/send_password", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ email: emailInput.value }),
    });

    const text = await response.text();
    let result;
    try { result = JSON.parse(text); }
    catch { result = { error: text }; }

    if (result.error) {
      errorLabel.textContent = result.error;
      errorLabel.style.display = "block";
    } else if (result.message) {
      messageSpan.textContent = result.message;
      messageSpan.style.display = "block";
    }
  } catch (e) {
    errorLabel.textContent = "Beklenmeyen bir hata oluştu.";
    errorLabel.style.display = "block";
  } finally {
    document.body.style.cursor = "default";
  }
}
</script>

</body>
</html>
